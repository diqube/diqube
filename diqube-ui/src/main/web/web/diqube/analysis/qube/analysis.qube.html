<!--

    diqube: Distributed Query Base.

    Copyright (C) 2015 Bastian Gloeckle

    This file is part of diqube.

    diqube is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
<div class="qube">
  <div class="qube-header">
  
    <span *ngIf="normalMode" class="qube-header-left">{{ qube.name }}</span>
    <div class="qube-action-list" *ngIf="normalMode">
      <span class="qube-slice qube-action">
        <i class="fa fa-pie-chart"></i>&nbsp;{{ slice.name }}
      </span>
      <a class="qube-action" title="Edit mode" (click)="switchToEditMode()"><i class="fa fa-gears"></i></a>
      <button class="btn btn-default qube-action" (click)="addQuery()" title="Add query">
        <i class="fa fa-plus add-action"></i></button>
    </div>
    
    
    <!-- EDIT MODE -->
        
    <div *ngIf="editMode" class="edit-qube">
      <form class="simple-form" (submit)="updateQube()" [ngFormModel]="formControlGroup">
        <div [class.has-succes]="nameValid === true"
             [class.has-error]="nameValid === false"
             class="qube-header-left has-feedback form-group">
          <input type="text" class="form-control" id="inputName"
            placeholder="Name of qube" [(ngModel)]="qubeEdit.name" 
            ngControl="nameControl">
          <span *ngIf="nameControl.dirty && nameControl.valid" class="fa fa-check form-control-feedback"></span>
          <span *ngIf="nameControl.dirty && !nameControl.valid" class="fa fa-exclamation-triangle form-control-feedback"></span>
        </div>
        <div class="qube-action-list">
          <a *ngIf="!working" class="qube-action" title="Remove qube" (click)="switchToRemoveMode()"><i class="fa fa-minus remove-action"></i></a>

          <span class="qube-action">
            <i class="fa fa-pie-chart"></i>
            <select [(ngModel)]="qubeEdit.sliceId" class="qube-action form-control">
              <option *ngFor="#slice of analysis.slices" [value]="slice.id">{{ slice.name }}</option>
            </select>
          </span>
          
          <a *ngIf="!working" class="qube-action" title="Cancel edit" (click)="switchToNormalMode()"><i class="fa fa-close"></i></a>
          <a *ngIf="!working" class="qube-action" title="Save" (click)="updateQube()"><i class="fa fa-floppy-o"></i></a>
          <i *ngIf="working" class="qube-action fa fa-spinner fa-spin"></i>
        </div>
      </form>
    </div>
  </div>
  
  <!-- qube display -->
  <div class="query-container" *ngIf="!removeMode">
    <div *ngFor="#query of qube.queries">
      <diqube-analysis-query [qube]="qube" [query]="query"></diqube-analysis-query>
    </div>
  </div>
  
  <!-- REMOVE MODE -->
  <div *ngIf="removeMode" class="remove-qube">
    <div class="qube-header">
      <span class="qube-header-left">{{ qube.name }}</span>
    </div>
    <p>Are you sure you want to remove this qube?</p>
    <p>
      <button class="btn btn-default" (click)="switchToNormalMode()">Cancel</button>
      <button class="btn btn-danger" (click)="removeQube()">Yes, remove.</button>
    </p>
  </div>
</div>