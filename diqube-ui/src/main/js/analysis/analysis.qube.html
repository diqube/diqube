<!--

    diqube: Distributed Query Base.

    Copyright (C) 2015 Bastian Gloeckle

    This file is part of diqube.

    diqube is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
<div class="qube">
  <div class="qube-header">
    <span ng-if="!editMode" class="qube-header-left">{{ qube.name }}</span>
    
    <div ng-if="editMode" class="edit-qube">
      <form novalidate class="qube-header-left simple-form" ng-submit="updateQubeName(qubeCopy)">
        <div class="has-feedback form-group {{ nameValid === true ? 'has-success' : '' }} {{ nameValid === false ? 'has-error' : '' }}">
          <input type="text" class="form-control" id="inputName"
            placeholder="Name of qube" ng-model="qubeCopy.name" 
            ng-change="validateName(qubeCopy.name)">
          <span ng-if="nameValid === true" class="fa fa-check form-control-feedback"></span>
          <span ng-if="!nameValid" class="fa fa-exclamation-triangle form-control-feedback"></span>
        </div>
      </form>
      <a ng-if="!working" href title="Cancel edit" ng-click="toggleEditMode()"><i class="fa fa-close"></i></a>
      <a ng-if="!working" href title="Save" ng-click="updateQubeName(qubeCopy)"><i class="fa fa-floppy-o"></i></a>
      <i ng-if="working" class="query-header-action fa fa-spinner fa-spin"></i>
    </div>
      
    <div class="qube-action-list">
      <a href class="qube-action" title="Edit mode" ng-click="toggleEditMode()"><i class="fa fa-gears"></i></a>
      <span class="qube-slice qube-action">
        <i class="fa fa-pie-chart"></i> {{ slice.name }}
      </span>
      <button class="btn btn-default qube-action" ng-click="addQuery()" title="Add query">
        <i class="fa fa-plus"></i></button>
    </div>
  </div>
  <div class="query-container">
    <div ng-repeat="query in qube.queries">
      <diqube-query qube="qube" query="query" analysis="analysis"></diqube-query>
    </div>
  </div>
</div>