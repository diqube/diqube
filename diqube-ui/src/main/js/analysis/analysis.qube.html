<!--

    diqube: Distributed Query Base.

    Copyright (C) 2015 Bastian Gloeckle

    This file is part of diqube.

    diqube is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
<div class="qube">
  <div class="qube-header">
  
    <span ng-if="!editMode" class="qube-header-left">{{ qube.name }}</span>
    <div class="qube-action-list" ng-if="!editMode">
      <span class="qube-slice qube-action">
        <i class="fa fa-pie-chart"></i>&nbsp;{{ slice.name }}
      </span>
      <a href class="qube-action" title="Edit mode" ng-click="toggleEditMode()"><i class="fa fa-gears"></i></a>
      <button class="btn btn-default qube-action" ng-click="addQuery()" title="Add query">
        <i class="fa fa-plus add-action"></i></button>
    </div>
    
    <!-- EDIT MODE -->
        
    <div ng-if="editMode" class="edit-qube">
      <form novalidate class="simple-form" ng-submit="updateQube(qubeCopy)">
        <div class="qube-header-left has-feedback form-group {{ nameValid === true ? 'has-success' : '' }} {{ nameValid === false ? 'has-error' : '' }}">
          <input type="text" class="form-control" id="inputName"
            placeholder="Name of qube" ng-model="qubeCopy.name" 
            ng-change="validateName(qubeCopy.name)">
          <span ng-if="nameValid === true" class="fa fa-check form-control-feedback"></span>
          <span ng-if="!nameValid" class="fa fa-exclamation-triangle form-control-feedback"></span>
        </div>
        <div class="qube-action-list">
          <span class="qube-action">
            <i class="fa fa-pie-chart"></i>
            <select ng-model="qubeCopy.sliceId" class="qube-action form-control" 
                    ng-options="slice.id as slice.name for slice in analysis.slices">
            </select>
          </span>
          
          <a ng-if="!working" class="qube-action" href title="Cancel edit" ng-click="toggleEditMode()"><i class="fa fa-close"></i></a>
          <a ng-if="!working" class="qube-action" href title="Save" ng-click="updateQube(qubeCopy)"><i class="fa fa-floppy-o"></i></a>
          <i ng-if="working" class="qube-action fa fa-spinner fa-spin"></i>
        </div>
      </form>
    </div>
  </div>
  <div class="query-container">
    <div ng-repeat="query in qube.queries">
      <diqube-query qube="qube" query="query" analysis="analysis"></diqube-query>
    </div>
  </div>
</div>