<!--

    diqube: Distributed Query Base.

    Copyright (C) 2015 Bastian Gloeckle

    This file is part of diqube.

    diqube is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
<h1 class="page-header">Create Analysis</h1>
<p />
<div ng-if="createAnalysis.error" class="alert alert-danger">
  <i class="fa fa-exclamation-circle"></i>
  {{ createAnalysis.error }}
</div> 
<p />
<form novalidate class="create-analysis" ng-submit="createAnalysis.createAnalysis(analysis)">
  <div class="form-group simple-form has-feedback {{ createAnalysis.nameValid === true ? 'has-success' : '' }} {{ createAnalysis.nameValid === false ? 'has-error' : '' }}">
    <label for="inputName" class="control-label">Name</label>
    <input type="text" class="form-control" id="inputName"
      placeholder="Name of new Analysis" ng-model="analysis.name" 
      ng-change="createAnalysis.validateName(analysis.name)">
    <span ng-if="createAnalysis.nameValid === true" class="fa fa-check form-control-feedback"></span>
    <span ng-if="createAnalysis.nameValid === false" class="fa fa-exclamation-triangle form-control-feedback"></span>
  </div>
  <div class="form-group has-feedback {{ createAnalysis.tableValid === true ? 'has-success' : '' }} {{ createAnalysis.tableValid === false ? 'has-error' : '' }} {{ noResults ? 'has-warning' : '' }}">
    <label for="inputTable" class="control-label">Table
      <i ng-show="loadingTables" class="fa fa-refresh fa-spin" title="Loading tables..."></i>
    </label> 
    <input type="text" class="form-control" id="inputTable" ng-model="analysis.table"
      placeholder="Table you want to analyze"
      typeahead="table.name for table in createAnalysis.getValidTables($viewValue)" 
      typeahead-editable="true"
      typeahead-loading="loadingTables" 
      typeahead-no-results="noResults"
      typeahead-select-on-exact="true"
      ng-focus="createAnalysis.tableValid = undefined"
      ng-blur="createAnalysis.validateTable(analysis.table)">
    <span ng-if="createAnalysis.tableValid === true && !noResults" class="fa fa-check form-control-feedback"></span>
    <span ng-if="createAnalysis.tableValid === false" class="fa fa-exclamation-triangle form-control-feedback"></span>
    <span ng-if="noResults" class="fa fa-question-circle form-control-feedback"></span>
  </div>
  <button type="submit" class="btn btn-primary" ng-disabled="createAnalysis.isCreating">Create</button>
</form>