<!--

    diqube: Distributed Query Base.

    Copyright (C) 2015 Bastian Gloeckle

    This file is part of diqube.

    diqube is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->
<h1 class="page-header">{{analysis.title}} <small>{{analysis.table}}</small></h1>

<div class="alert alert-danger {{ analysis.error ? '' : 'hidden'}}">
  <span class="glyphicon glyphicon-exclamation-sign"></span>
  {{ analysis.error }}
</div>

<div class="{{ analysis.error ? 'hidden' : ''}}">
  <button class="btn btn-default add-qube-btn" ng-click="analysis.addQube()"><i class="glyphicon glyphicon-plus"></i> Add qube</button>

  <div class="container-fluid text-justify">
    <div ng-repeat="qube in analysis.qubes" class="qube-row">
      <div class="qube">
        <div class="qube-header">
          <span class="lead">{{qube.name}}</span>
          <div class="pull-right">
            <button class="btn btn-default" ng-click="analysis.addQuery(qube)"><i class="glyphicon glyphicon-plus"></i> Add query</button>
          </div>
        </div>
        <div class="query-container">
          <div class="query" ng-repeat="query in qube.queries">
            <div class="query-header">
              <span>{{ query.name }}</span>
              
              <progressbar class="{{ query.results.percentComplete != 100 ? '' : 'hidden' }}" 
                value="query.results.percentComplete">{{ query.results.percentComplete }}%</progressbar>
            </div>
            <div class="{{ (query.results && query.results.exception) ? '' : 'hidden'}}" class="alert alert-danger">
              <span class="glyphicon glyphicon-exclamation-sign"></span>
              {{ query.results.exception }}
            </div>
            
            <table  class="table table-hover table-condensed {{ (query.results && !query.results.exception) ? '' : 'hidden'}}">
              <thead>
                <tr>
                  <th ng-repeat="colName in query.results.columnNames">{{colName}}</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="row in query.results.rows track by $index">
                  <td ng-repeat="col in row track by $index">{{col}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>